<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>微信开发－微信JS-SDK扫一扫功能 | DaceYu_Space</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">微信开发－微信JS-SDK扫一扫功能</h1><a id="logo" href="/.">DaceYu_Space</a><p class="description">Coding....</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="https://github.com/daceYu"><i class="fa fa-rss"> GitHub</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">微信开发－微信JS-SDK扫一扫功能</h1><div class="post-meta">Feb 16, 2017<span> | </span><span class="category"><a href="/categories/微信/">微信</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/02/16/wx/" href="/2017/02/16/wx/#comments" class="ds-thread-count"></a><div class="post-content"><h4 id="u73B0_u9636_u6BB5_u5E02_u9762_u4E0A_u5FAE_u5E97_u7EB5_u6A2A_uFF0C_u8BB8_u591A_u60C5_u51B5_u9700_u8981_u7528_u5230_u5FAE_u4FE1_u626B_u4E00_u626B_u4EE5_u53CA_u5176_u4ED6_u7684_u529F_u80FD_uFF0C_u8FD9_u91CC_u4EE5_u626B_u4E00_u626B_u4E3A_u4F8B_uFF0C_u7B80_u5355_u7684_u4ECB_u7ECD_u4E00_u4E0B_u7528_u6CD5_u3002"><a href="#u73B0_u9636_u6BB5_u5E02_u9762_u4E0A_u5FAE_u5E97_u7EB5_u6A2A_uFF0C_u8BB8_u591A_u60C5_u51B5_u9700_u8981_u7528_u5230_u5FAE_u4FE1_u626B_u4E00_u626B_u4EE5_u53CA_u5176_u4ED6_u7684_u529F_u80FD_uFF0C_u8FD9_u91CC_u4EE5_u626B_u4E00_u626B_u4E3A_u4F8B_uFF0C_u7B80_u5355_u7684_u4ECB_u7ECD_u4E00_u4E0B_u7528_u6CD5_u3002" class="headerlink" title="现阶段市面上微店纵横，许多情况需要用到微信扫一扫以及其他的功能，这里以扫一扫为例，简单的介绍一下用法。"></a>现阶段市面上微店纵横，许多情况需要用到微信扫一扫以及其他的功能，这里以扫一扫为例，简单的介绍一下用法。</h4><p>首先请阅读微信JS-SDK说明文档，了解微信JS的相关说明。<br>根据官方的使用步骤，关键的有以下几步<br><a id="more"></a></p>
<ol>
<li>绑定域名（<strong>很关键</strong>）</li>
<li>引入JS文件（很简单）</li>
<li>通过config接口注入权限验证配置（<strong>很重要</strong>）</li>
<li>通过ready接口处理成功验证（还没用到）</li>
<li>通过error接口处理失败验证（还没用到）</li>
</ol>
<h3 id="u6B65_u9AA4_u4E00_uFF1A_u7ED1_u5B9A_u57DF_u540D"><a href="#u6B65_u9AA4_u4E00_uFF1A_u7ED1_u5B9A_u57DF_u540D" class="headerlink" title="步骤一：绑定域名"></a>步骤一：绑定域名</h3><p><img src="http://daceyu.com/images/1.png" alt="例"></p>
<p>如果域名绑定有误，会出现如下错误提示<br>错误的域名配置示例：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/gwchsk.imwork.net/wechat</span><span class="regexp">/order/test</span>.html</span><br></pre></td></tr></table></figure></p>
<p>域名配置错误的提示信息：<br><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">'errMsg'</span>:<span class="symbol">'config</span>:invalid url domain'&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://daceyu.com/images/2.png" alt="例"></p>
<p>所以，域名配置的时候一定要注意 </p>
<ol>
<li><strong>域名不要以http:开头</strong></li>
<li><strong>域名不要配置到具体的页面</strong> </li>
</ol>
<p>配置成功的提示如下<br><img src="http://daceyu.com/images/3.png" alt="例"></p>
<h3 id="u6B65_u9AA4_u4E8C_uFF1A_u5F15_u5165JS_u6587_u4EF6"><a href="#u6B65_u9AA4_u4E8C_uFF1A_u5F15_u5165JS_u6587_u4EF6" class="headerlink" title="步骤二：引入JS文件"></a>步骤二：引入JS文件</h3><p>一行代码就可以了<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://res.wx.qq.com/open/js/jweixin-1.0.0.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="u6B65_u9AA4_u4E09_uFF1A_u901A_u8FC7config_u63A5_u53E3_u6CE8_u5165_u6743_u9650_u9A8C_u8BC1_u914D_u7F6E"><a href="#u6B65_u9AA4_u4E09_uFF1A_u901A_u8FC7config_u63A5_u53E3_u6CE8_u5165_u6743_u9650_u9A8C_u8BC1_u914D_u7F6E" class="headerlink" title="步骤三：通过config接口注入权限验证配置"></a>步骤三：通过config接口注入权限验证配置</h3><p>这一步非常重要，也是最关键的一步，这一部分<br>先看官方的示例<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">wx</span><span class="class">.config</span>(&#123;</span><br><span class="line">	<span class="attribute">debug</span>: true, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span></span><br><span class="line">	<span class="attribute">appId</span>: <span class="string">''</span>, <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">	<span class="attribute">timestamp</span>: , <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">	<span class="attribute">nonceStr</span>: <span class="string">''</span>, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">	<span class="attribute">signature</span>: <span class="string">''</span>,<span class="comment">// 必填，签名，见附录1</span></span><br><span class="line">	<span class="attribute">jsApiList</span>: [] <span class="comment">// 必填，需要使用的JS接口列表，所有JS接口列表见附录2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这里需要从服务器端网页面传递的参数有<code>timestamp</code>、<code>nonceStr</code>和<code>signature</code>而<code>appId</code>和<code>jsApiList</code>都是固定的，这里直接写在页面中。</p>
<p>首先，编写服务器端代码，生成<code>timestamp</code>、<code>nonceStr</code>和<code>signature</code>。<br>在生成<code>timestamp</code>、<code>nonceStr</code>和<code>signature</code>的时候有两个参数需要获取<br>一个是<code>access_token</code>，另一个是<code>jsapi_ticket</code>。</p>
<p><code>access_token</code>的获取需要<code>AppId</code>和<code>AppSecret</code>，获取地址如下，发送GET请求<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https:</span><span class="comment">//api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</span></span><br></pre></td></tr></table></figure></p>
<p>通过<code>HttpClient发送http请求</code>就可以获取到<code>access_token</code><br>得到<code>access_token</code>之后，采用<code>http GET方式</code>请求获得<code>jsapi_ticket</code><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http<span class="variable">s:</span>//api.weixin.qq.<span class="keyword">com</span>/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&amp;<span class="built_in">type</span>=jsapi</span><br></pre></td></tr></table></figure></p>
<p>注意，<strong>access_token和jsapi_ticket得有效期为7200秒</strong>，开发者必须在自己的服务全局缓存<br>获得<code>jsapi_ticket</code>之后，就可以生成<code>JS-SDK权限验证的签名</code>了。</p>
<blockquote>
<p>签名算法<br>签名生成规则如下：参与签名的字段包括noncestr（随机字符串）, 有效的jsapi_ticket, timestamp（时间戳）, url（当前网页的URL，不包含#及其后面部分） 。对所有待签名参数按照字段名的ASCII 码从小到大排序（字典序）后，使用URL键值对的格式（即key1=value1&amp;key2=value2…）拼接成字符串string1。这里需要注意的是所有参数名均为小写字符。对string1作sha1加密，字段名和字段值都采用原始值，不进行URL 转义。</p>
</blockquote>
<h4 id="u7B7E_u540D_u7B97_u6CD5_u7684_u5B9E_u73B0"><a href="#u7B7E_u540D_u7B97_u6CD5_u7684_u5B9E_u73B0" class="headerlink" title="签名算法的实现"></a>签名算法的实现</h4><p>最难的就是签名算法的实现部分，幸好微信给了demo，网上好多人都在找，这里我把签名算法的实现贴出来，代码来自微信demo<br><img src="http://daceyu.com/images/4.png" alt="例"></p>
<p><strong>Java代码如下，做了一点点修改</strong><br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gwc.wechat.utils.wechat;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Formatter;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="keyword">HashMap</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">public</span> class WxJSUtil &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">	    <span class="comment">// 注意 URL 一定要动态获取，不能 hardcode</span></span><br><span class="line">	    <span class="keyword">String</span> url = <span class="string">"http://gwchsk.imwork.net/wechat/order/test.html"</span>;</span><br><span class="line">	    Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; ret = sign(url);</span><br><span class="line">	    <span class="keyword">for</span> (Map.Entry entry : ret.entrySet()) &#123;</span><br><span class="line">	        System.out.<span class="built_in">println</span>(entry.getKey() + <span class="string">"="</span> + entry.getValue());</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; sign(<span class="keyword">String</span> url) &#123;</span><br><span class="line">	    Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; ret = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;();</span><br><span class="line">	    <span class="comment">//这里的jsapi_ticket是获取的jsapi_ticket。</span></span><br><span class="line">	    <span class="keyword">String</span> jsapi_ticket = JSAPITicketTool.getTicket();</span><br><span class="line">	    <span class="keyword">String</span> nonce_str = create_nonce_str();</span><br><span class="line">	    <span class="keyword">String</span> timestamp = create_timestamp();</span><br><span class="line">	    <span class="keyword">String</span> string1;</span><br><span class="line">	    <span class="keyword">String</span> signature = <span class="string">""</span>;</span><br><span class="line">	    <span class="comment">//注意这里参数名必须全部小写，且必须有序</span></span><br><span class="line">	    string1 = <span class="string">"jsapi_ticket="</span> + jsapi_ticket +</span><br><span class="line">	              <span class="string">"&amp;noncestr="</span> + nonce_str +</span><br><span class="line">	              <span class="string">"&amp;timestamp="</span> + timestamp +</span><br><span class="line">	              <span class="string">"&amp;url="</span> + url;</span><br><span class="line">	   <span class="comment">// System.out.println(string1);</span></span><br><span class="line">	    <span class="keyword">try</span></span><br><span class="line">	    &#123;</span><br><span class="line">	        MessageDigest crypt = MessageDigest.getInstance(<span class="string">"SHA-1"</span>);</span><br><span class="line">	        crypt.reset();</span><br><span class="line">	        crypt.update(string1.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">	        signature = byteToHex(crypt.digest());</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">catch</span> (NoSuchAlgorithmException e)</span><br><span class="line">	    &#123;</span><br><span class="line">	        e.printStackTrace();</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">catch</span> (UnsupportedEncodingException e)</span><br><span class="line">	    &#123;</span><br><span class="line">	        e.printStackTrace();</span><br><span class="line">	    &#125;</span><br><span class="line">	    ret.put(<span class="string">"url"</span>, url);</span><br><span class="line">	    ret.put(<span class="string">"jsapi_ticket"</span>, jsapi_ticket);</span><br><span class="line">	    ret.put(<span class="string">"nonceStr"</span>, nonce_str);</span><br><span class="line">	    ret.put(<span class="string">"timestamp"</span>, timestamp);</span><br><span class="line">	    ret.put(<span class="string">"signature"</span>, signature);</span><br><span class="line">	    <span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> byteToHex(<span class="keyword">final</span> <span class="built_in">byte</span>[] hash) &#123;</span><br><span class="line">	    Formatter formatter = <span class="keyword">new</span> Formatter();</span><br><span class="line">	    <span class="keyword">for</span> (<span class="built_in">byte</span> b : hash)</span><br><span class="line">	    &#123;</span><br><span class="line">	        formatter.format(<span class="string">"%02x"</span>, b);</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">String</span> result = formatter.toString();</span><br><span class="line">	    formatter.close();</span><br><span class="line">	    <span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> create_nonce_str() &#123;</span><br><span class="line">	    <span class="keyword">return</span> UUID.randomUUID().toString();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> create_timestamp() &#123;</span><br><span class="line">	    <span class="keyword">return</span> Long.toString(System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Controller的代码</strong><br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Controller</span></span><br><span class="line"><span class="annotation">@RequestMapping</span>(value = <span class="string">"/order"</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line"><span class="annotation">@RequestMapping</span>(value = <span class="string">"/test.html"</span>, method = RequestMethod.GET)</span><br><span class="line">    public <span class="built_in">String</span> testPage(Model model) &#123;</span><br><span class="line">        <span class="built_in">String</span> url = Constant.AppURL + <span class="string">"/order/test.html"</span>;</span><br><span class="line">        <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; ret = WxJSUtil.sign(url);</span><br><span class="line">         <span class="keyword">for</span> (<span class="built_in">Map</span>.Entry entry : ret.entrySet()) &#123;</span><br><span class="line">                System.out.println(entry.getKey() + <span class="string">"="</span> + entry.getValue());</span><br><span class="line">                model.addAttribute(entry.getKey().toString(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"jqueryMobile"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>在Controller中将如下参数写进了jsp页面</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">timestamp=<span class="number">1449132293</span></span><br><span class="line">nonceStr=fb4eaa58-<span class="number">6</span>d53-<span class="number">40</span>a8-a8fa-<span class="number">7033e9768</span>a8a</span><br><span class="line">signature=<span class="number">7</span>ad32da3f82cb36492de935a60727d3053d33f4b</span><br></pre></td></tr></table></figure></p>
<p>其次编写jsp页面的代码<br>在jsp页面中需要将wx.config重的参数进行配置<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">wx</span><span class="class">.config</span>(&#123;</span><br><span class="line">    <span class="attribute">debug</span>: true, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span></span><br><span class="line">    <span class="attribute">appId</span>: <span class="string">''</span>, <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">    <span class="attribute">timestamp</span>: , <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">    <span class="attribute">nonceStr</span>: <span class="string">''</span>, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">    <span class="attribute">signature</span>: <span class="string">''</span>,<span class="comment">// 必填，签名，见附录1</span></span><br><span class="line">    <span class="attribute">jsApiList</span>: [] <span class="comment">// 必填，需要使用的JS接口列表，所有JS接口列表见附录2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>在页面中读值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=<span class="string">"timestamp"</span> <span class="built_in">type</span>=<span class="string">"hidden"</span> value=<span class="string">"<span class="variable">$&#123;timestamp&#125;</span>"</span> /&gt;</span><br><span class="line">&lt;input id=<span class="string">"noncestr"</span> <span class="built_in">type</span>=<span class="string">"hidden"</span> value=<span class="string">"<span class="variable">$&#123;nonceStr&#125;</span>"</span> /&gt;</span><br><span class="line">&lt;input id=<span class="string">"signature"</span> <span class="built_in">type</span>=<span class="string">"hidden"</span> value=<span class="string">"<span class="variable">$&#123;signature&#125;</span>"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>然后赋值<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> timestamp = $(<span class="string">"#timestamp"</span>).val();<span class="comment">//时间戳</span></span><br><span class="line">        <span class="keyword">var</span> nonceStr = $(<span class="string">"#noncestr"</span>).val();<span class="comment">//随机串</span></span><br><span class="line">        <span class="keyword">var</span> signature = $(<span class="string">"#signature"</span>).val();<span class="comment">//签名</span></span><br><span class="line">        wx.config(&#123;</span><br><span class="line">            debug : <span class="literal">true</span>, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span></span><br><span class="line">            appId : <span class="string">'wx622ca8545e5c354b'</span>, <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">            timestamp : timestamp, <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">            nonceStr : nonceStr, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">            signature : signature,<span class="comment">// 必填，签名，见附录1</span></span><br><span class="line">            jsApiList : [ <span class="string">'scanQRCode'</span> ]</span><br><span class="line">        <span class="comment">// 必填，需要使用的JS接口列表，所有JS接口列表见附录2</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>写一个按钮和输入框，将扫描的结果放进输入框<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="tag">input</span> id=<span class="string">"id_securityCode_input"</span>&gt;</span><br><span class="line">&lt;<span class="tag">button</span> id=<span class="string">"scanQRCode"</span>&gt;扫码&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>给按钮绑定事件，并执行微信扫码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#scanQRCode"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    wx.scanQRCode(&#123;</span><br><span class="line">        <span class="comment">// 默认为0，扫描结果由微信处理，1则直接返回扫描结果</span></span><br><span class="line">        needResult : <span class="number">1</span>,</span><br><span class="line">        desc : <span class="string">'scanQRCode desc'</span>,</span><br><span class="line">        success : <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//扫码后获取结果参数赋值给Input</span></span><br><span class="line">            <span class="keyword">var</span> url = res.resultStr;</span><br><span class="line">            <span class="comment">//商品条形码，取","后面的</span></span><br><span class="line">            <span class="keyword">if</span>(url.indexOf(<span class="string">","</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> tempArray = url.split(<span class="string">','</span>);</span><br><span class="line">                <span class="keyword">var</span> tempNum = tempArray[<span class="number">1</span>];</span><br><span class="line">                $(<span class="string">"#id_securityCode_input"</span>).val(tempNum);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $(<span class="string">"#id_securityCode_input"</span>).val(url);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>运行结果如图<br><img src="http://daceyu.com/images/5.png" alt="例"><br><img src="http://daceyu.com/images/6.png" alt="例"><br><img src="http://daceyu.com/images/7.png" alt="例"><br><img src="http://daceyu.com/images/8.png" alt="例"></p>
<h5 id="u5FAE_u4FE1JS-SDK_u4E2D_u7684_u626B_u4E00_u626B_u5C31_u57FA_u672C_u5B9E_u73B0_u4E86_u3002"><a href="#u5FAE_u4FE1JS-SDK_u4E2D_u7684_u626B_u4E00_u626B_u5C31_u57FA_u672C_u5B9E_u73B0_u4E86_u3002" class="headerlink" title="微信JS-SDK中的扫一扫就基本实现了。"></a>微信JS-SDK中的扫一扫就基本实现了。</h5><hr>
<p><strong>如果要在多个页面调用此功能，则可以将请求的签名封装成一个接口，然后在其他页面异步请求，调用此功能。</strong></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://daceyu.com/2017/02/16/wx/" data-id="cizkvhzt4000020trl1t3h80v" class="article-share-link">分享到</a><div class="tags"><a href="/tags/自用笔记/">自用笔记</a></div><div class="post-nav"><a href="/2017/02/25/wxD/" class="pre">微信开发－有关微信分享我踩过的坑</a><a href="/2016/10/08/图片预览上传/" class="next">(组件)图片预览上传</a></div><div data-thread-key="2017/02/16/wx/" data-title="微信开发－微信JS-SDK扫一扫功能" data-url="http://daceyu.com/2017/02/16/wx/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/02/16/wx/" data-title="微信开发－微信JS-SDK扫一扫功能" data-url="http://daceyu.com/2017/02/16/wx/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://daceyu.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS3/">CSS3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/">前端开发</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/移动端/">移动端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/移动端/框架/">框架</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/移动端/用户体验/">用户体验</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/移动端/组件/">组件</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/微信/">微信</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术无界/">技术无界</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/自用笔记/" style="font-size: 15px;">自用笔记</a> <a href="/tags/jqueryMobile/" style="font-size: 15px;">jqueryMobile</a> <a href="/tags/正则表达/" style="font-size: 15px;">正则表达</a> <a href="/tags/PS/" style="font-size: 15px;">PS</a> <a href="/tags/zepto/" style="font-size: 15px;">zepto</a> <a href="/tags/bootstrap/" style="font-size: 15px;">bootstrap</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/grunt/" style="font-size: 15px;">grunt</a> <a href="/tags/ajax/" style="font-size: 15px;">ajax</a> <a href="/tags/CSS-HACK/" style="font-size: 15px;">CSS HACK</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/25/wxD/">微信开发－有关微信分享我踩过的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/16/wx/">微信开发－微信JS-SDK扫一扫功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/08/图片预览上传/">(组件)图片预览上传</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/01/iscroll.js回弹bug/">解决iscroll.js上拉下拉刷新手指划出屏幕页面无法回弹问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/19/node_chat/">Node.js + Web Socket 开源聊天室学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/grunt/">Grunt集成自启动工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/11/node+express/">node+express学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/07/微信脚本/">定时器发送微信信息</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/linear-gradient/">CSS3 线性渐变（linear-gradient）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/zepto&&jQuery/">jQuery Mobile还是Zepto?</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://huangbingbing.com" title="ahBing" target="_blank">ahBing</a><ul></ul><a href="http://liyi.it" title="liyi" target="_blank">liyi</a><ul></ul><a href="http://makaiqian.com" title="maZu" target="_blank">maZu</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">DaceYu_Space.</a> created by<a rel="nofollow" target="_blank" href="https://daceyu.com"> Daceyu.</a> copy @ 2015 - 2016</div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'daceyu'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>