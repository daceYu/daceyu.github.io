require("common:widget/pager/jquery.pager.js");var pagecount,totalcount,pagenumber,lessonlist={init:function(){this.changeStyle(),this.tagtype(),this.askSuggest(),this.insert(),this.wikiloadonw(),this.videoDownload()},wikiloadonw:function(){$(".weibox").parent().hover(function(){$(this).children(".weibox").height("auto")},function(){$(this).children(".weibox").height(0)})},insert:function(){function e(e){if("object"==typeof e){var i='<li class="cf">';i+='<div class="lessonimg-box">';var t;return t=void 0!=e&&void 0!=e.user&&""!=e.user.detail&&""!=e.user.detail.domain?e.user.detail.domain:e.user.detail.uuid,i+=void 0!=e&&void 0!=e.user&&""!=e.user.pic?'<a href="http://my.jikexueyuan.com/'+t+'/" target="_blank" rel="external"><img src="'+e.user.pic+'" class="lessonimg"></a>':'<a href="http://my.jikexueyuan.com/'+t+'/" target="_blank" rel="external"><img src="'+s+'" class="lessonimg"></a>',i+="</div>",i+='<div class="lesson-infor"><h2><a href="http://wenda.jikexueyuan.com/question/'+e.id+'/" target="_blank" jktag="&posGP=104001&posArea=0004&posOper=8016&posColumn='+e.id+" .0&aqid="+e.id+'">'+e.title+"</a>",i+="</h2>",i+='<div class="timeandicon">',i+='<div class="cf">',i+="<dl>",i+=""!=e.user&&void 0!=e.user.uname?'<dd class="mar-b8"><a style="color:#333" href="http://my.jikexueyuan.com/'+t+'/" target="_blank" rel="external">'+e.user.uname+"</a></dd>":'<dd class="mar-b8"> </dd>',""!=e.last_replyed_at&&"0000-00-00 00:00:00"!=e.last_replyed_at&&(i+='<dd class="zhongji"> 最后回答：<span>'+e.last_replyed_at+"</span></dd>"),i+='</dl></div><div class="ask-text"><p>'+e.content+"</p></div></div></div>",i+=e.replies_count>0?'<div class="lesson-number f_r"><span class="blue-color">'+e.replies_count+"</span> <p>讨论中</p></div>":'<div class="lesson-number f_r"><span>'+e.replies_count+"</span><p>暂无回复</p></div></li>"}}var s="http://s1.jikexueyuan.com/course/images/default_df58664.gif",i=!0;1==i&&$("#qa_subask_submit").click(function(){function s(){$("#qa_subask_submit").html("发布问题").attr("stop","0").removeClass("stopbtn")}function t(){$("#qa_subask_submit").html("问题提交中…… ").attr("stop","1").addClass("stopbtn")}if(0==i)return!1;var a=$("#qa_sub_title").val(),n=$("#editor").val(),l=$(".player-video").attr("course_id"),o=$(".player-video").attr("seq"),r=$("input[name='qalevel']:checked").val(),c=$("input[name='send_email']").prop("checked");if(1==c)var c=1;else var c=0;var d=($("#qa_subask").find("input[name=safecode]").val(),$("input[name='_csrf']").val());if(""==$.trim(a))return JKXY.msgBox(1,"请输入提问标题"),!1;if(""==$.trim(n))return JKXY.msgBox(1,"请输入提问内容"),!1;if(""!=$.trim(n)){if(1==parseInt($("#qa_subask_submit").attr("stop")))return!1;t(),i=!1;var u={title:encodeURIComponent(a),content:encodeURIComponent(n),course_id:l,seq:o,qalevel:r,send_email:c,_csrf:d};return $.ajax({type:"post",url:"/course/insert/content",data:u,dataType:"json",success:function(t){s(),$("#qa_subask").find("input[name=safecode]").val(),"200"==t.code?(JKXY.msgBox(1,"问题提交成功 ：）",1500,function(){i=!0}),$("#editor").val(""),$("#qa_sub_title").val(""),$("#pop-tow").fadeOut(),$("#blacklayer").remove(),$("#course_question_list").prepend(e(t.data)),JKXY.vov.player.play()):JKXY.msgBox(1,t.msg,1500,function(){i=!1})},complete:function(){s()}}),!1}})},askSuggest:function(){function e(e){var s='<li class="cf"><div class="left-text"><p><a href="/question/'+e.id+'.html" target="_blank" style="color:#333;">'+e.title+"</a></p>";return s+=""!=e.user&&void 0!=e.user.uname?" <div><span>"+e.user.uname+"</span> <span>最后回答：<em>"+e.last_replyed_at+"</em></span></div>":" <div><span>"+e.user.uname+"</span> <span>最后回答：<em>"+e.last_replyed_at+"</em></span></div>",s+=e.replies_count>0?'</div><div class="tl-number"><em class="red-color">'+e.replies_count+"</em><span>讨论中</span></div></li>":'<div class="tl-number"><em class="gray-color">'+e.replies_count+"</em><span>暂无回复</span></div>"}$(document).ready(function(){$(".one-input").keyup(function(){var s=encodeURI($(".one-input").val()),i=$(".player-video").attr("course_id"),t={keyword:s,course_id:i};$.ajax({url:"/course/suggest/add",type:"get",data:t,dataType:"json",success:function(s){if(200==s.code){var i="";$("#returnQaTopics").empty();for(var t in s.data)i=e(s.data[t]),$("#returnQaTopics").append(i)}else $("#returnQaTopics").html("没有匹配的问题，请直接填写问题详细描述")}})})})},asklistPage:function(e,s,i){function t(e){$("#course_question_list").empty(),lessonlist.asklist(e)}$("#page-nav").pager({pagenumber:e,pagecount:s,totalcount:i,buttonClickCallback:t})},asklist:function(e){function s(e){function s(e){var s='<li class="cf">';s+='<div class="lessonimg-box">';var i;return i=void 0!=e&&void 0!=e.user&&""!=e.user.detail&&""!=e.user.detail.domain?e.user.detail.domain:e.user.detail.uuid,s+=void 0!=e&&void 0!=e.user&&""!=e.user.pic?'<a href="http://my.jikexueyuan.com/'+i+'/" target="_blank" rel="external"><img src="'+e.user.pic+'" class="lessonimg"></a>':'<a href="http://my.jikexueyuan.com/'+i+'/" target="_blank" rel="external"><img src="'+n+'" class="lessonimg"></a>',s+="</div>",s+='<div class="lesson-infor"><h2><a href="http://wenda.jikexueyuan.com/question/'+e.id+'/" target="_blank" jktag="&posGP=104001&posArea=0004&posOper=8016&posColumn='+e.id+" .0&aqid="+e.id+'">'+e.title+"</a>",s+="</h2>",s+='<div class="timeandicon">',s+='<div class="cf">',s+="<dl>",""!=e.user&&void 0!=e.user.uname&&(s+='<dd class="mar-b8"><a style="color:#333" href="http://my.jikexueyuan.com/'+i+'/" target="_blank" rel="external">'+e.user.uname+"</a></dd>"),""!=e.last_replyed_at&&"0000-00-00 00:00:00"!=e.last_replyed_at&&(s+='<dd class="zhongji"> 最后回答：<span>'+e.last_replyed_at+"</span></dd>"),s+='</dl></div><div class="ask-text"><p>'+e.content+"</p></div></div></div>",s+=e.replies_count>0?'<div class="lesson-number f_r"><span class="blue-color">'+e.replies_count+"</span> <p>讨论中</p></div>":'<div class="lesson-number f_r"><span>'+e.replies_count+"</span><p>暂无回复</p></div></li>"}var i=e.page,t=e.total_pages,a=e.page_items,n="http://s1.jikexueyuan.com/course/images/default_df58664.gif";lessonlist.asklistPage(i,t,a);for(var l=0;l